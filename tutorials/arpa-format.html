<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ARPA format &mdash; kaldilm 1.15.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Tutorials" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> kaldilm
          </a>
              <div class="version">
                1.15.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">ARPA format</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#how-to-generate-an-arpa-file">How to generate an arpa file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-interpret-an-arpa-file">How to interpret an arpa file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-use-score-a-sentence-using-arpa">How to use score a sentence using arpa</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#example-1-p-a-s">Example 1: p(a | &lt;s&gt;)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-2-p-a-b-s">Example 2: p(a b | &lt;s&gt;)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-3-p-a-b-s-s">Example 3: p(a b &lt;/s&gt; | &lt;s&gt;)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-4-p-b-d-s-s">Example 4: p(b d &lt;/s&gt; | &lt;s&gt;)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-use-kenlm-to-compute-scores">How to use kenLM to compute scores</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">kaldilm</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Tutorials</a> &raquo;</li>
      <li>ARPA format</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/csukuangfj/kaldilm/blob/master/docs/source/tutorials/arpa-format.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="arpa-format">
<h1>ARPA format<a class="headerlink" href="#arpa-format" title="Permalink to this headline"></a></h1>
<section id="how-to-generate-an-arpa-file">
<h2>How to generate an arpa file<a class="headerlink" href="#how-to-generate-an-arpa-file" title="Permalink to this headline"></a></h2>
<p>Given the following text,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>a<span class="w"> </span>b<span class="w"> </span>c<span class="w"> </span>d<span class="w"> </span>e
d<span class="w"> </span>e<span class="w"> </span>f<span class="w"> </span>a
a<span class="w"> </span>b<span class="w"> </span>c<span class="w"> </span>d<span class="w"> </span>e<span class="w"> </span>f<span class="w"> </span>a
</pre></div>
</div>
<p>we can convert it to a n-gram LM saved in <a class="reference external" href="https://cmusphinx.github.io/wiki/arpaformat/">ARPA format</a>
using the script <a class="reference external" href="https://github.com/k2-fsa/icefall/blob/master/icefall/shared/make_kn_lm.py">shared/make_kn_lm.py</a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;<span class="w"> </span>test.txt<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<span class="s">a b c d e</span>
<span class="s">d e f a</span>
<span class="s">a b c d e f a</span>
<span class="s">EOF</span>

wget<span class="w"> </span>https://raw.githubusercontent.com/k2-fsa/icefall/master/icefall/shared/make_kn_lm.py

python3<span class="w"> </span>./make_kn_lm.py<span class="w"> </span>-ngram-order<span class="w"> </span><span class="m">3</span><span class="w"> </span>-text<span class="w"> </span>./test.txt<span class="w"> </span>-lm<span class="w"> </span>test.arpa
</pre></div>
</div>
<p>The content of <code class="docutils literal notranslate"><span class="pre">test.arpa</span></code> is given below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">data</span>\
<span class="n">ngram</span> <span class="mi">1</span><span class="o">=</span><span class="mi">8</span>
<span class="n">ngram</span> <span class="mi">2</span><span class="o">=</span><span class="mi">10</span>
<span class="n">ngram</span> <span class="mi">3</span><span class="o">=</span><span class="mi">9</span>

\<span class="mi">1</span><span class="o">-</span><span class="n">grams</span><span class="p">:</span>
<span class="o">-</span><span class="mf">99.0000000</span>	<span class="o">&lt;</span><span class="n">s</span><span class="o">&gt;</span>	<span class="o">-</span><span class="mf">0.8573325</span>
<span class="o">-</span><span class="mf">0.6989700</span>	<span class="n">a</span>	<span class="o">-</span><span class="mf">0.7481880</span>
<span class="o">-</span><span class="mf">1.0000000</span>	<span class="n">b</span>	<span class="o">-</span><span class="mf">0.8573325</span>
<span class="o">-</span><span class="mf">1.0000000</span>	<span class="n">c</span>	<span class="o">-</span><span class="mf">0.8061800</span>
<span class="o">-</span><span class="mf">0.6989700</span>	<span class="n">d</span>	<span class="o">-</span><span class="mf">1.1583625</span>
<span class="o">-</span><span class="mf">1.0000000</span>	<span class="n">e</span>	<span class="o">-</span><span class="mf">0.7481880</span>
<span class="o">-</span><span class="mf">0.6989700</span>	<span class="o">&lt;/</span><span class="n">s</span><span class="o">&gt;</span>
<span class="o">-</span><span class="mf">1.0000000</span>	<span class="n">f</span>	<span class="o">-</span><span class="mf">0.8061800</span>

\<span class="mi">2</span><span class="o">-</span><span class="n">grams</span><span class="p">:</span>
<span class="o">-</span><span class="mf">0.2041200</span>	<span class="o">&lt;</span><span class="n">s</span><span class="o">&gt;</span> <span class="n">a</span>	<span class="o">-</span><span class="mf">0.9542425</span>
<span class="o">-</span><span class="mf">0.5351132</span>	<span class="o">&lt;</span><span class="n">s</span><span class="o">&gt;</span> <span class="n">d</span>	<span class="mf">0.3010300</span>
<span class="o">-</span><span class="mf">0.3590219</span>	<span class="n">a</span> <span class="n">b</span>	<span class="o">-</span><span class="mf">0.3010300</span>
<span class="o">-</span><span class="mf">0.3590219</span>	<span class="n">a</span> <span class="o">&lt;/</span><span class="n">s</span><span class="o">&gt;</span>
<span class="o">-</span><span class="mf">0.0579919</span>	<span class="n">b</span> <span class="n">c</span>	<span class="o">-</span><span class="mf">0.3010300</span>
<span class="o">-</span><span class="mf">0.0579919</span>	<span class="n">c</span> <span class="n">d</span>	<span class="mf">0.0000000</span>
<span class="o">-</span><span class="mf">0.0280287</span>	<span class="n">d</span> <span class="n">e</span>	<span class="o">-</span><span class="mf">0.1760913</span>
<span class="o">-</span><span class="mf">0.3590219</span>	<span class="n">e</span> <span class="o">&lt;/</span><span class="n">s</span><span class="o">&gt;</span>
<span class="o">-</span><span class="mf">0.3590219</span>	<span class="n">e</span> <span class="n">f</span>	<span class="o">-</span><span class="mf">0.3010300</span>
<span class="o">-</span><span class="mf">0.0579919</span>	<span class="n">f</span> <span class="n">a</span>	<span class="o">-</span><span class="mf">0.9542425</span>

\<span class="mi">3</span><span class="o">-</span><span class="n">grams</span><span class="p">:</span>
<span class="o">-</span><span class="mf">0.0280287</span>	<span class="o">&lt;</span><span class="n">s</span><span class="o">&gt;</span> <span class="n">a</span> <span class="n">b</span>
<span class="o">-</span><span class="mf">0.0280287</span>	<span class="n">a</span> <span class="n">b</span> <span class="n">c</span>
<span class="o">-</span><span class="mf">0.0280287</span>	<span class="n">b</span> <span class="n">c</span> <span class="n">d</span>
<span class="o">-</span><span class="mf">0.0280287</span>	<span class="n">c</span> <span class="n">d</span> <span class="n">e</span>
<span class="o">-</span><span class="mf">0.5351132</span>	<span class="n">d</span> <span class="n">e</span> <span class="o">&lt;/</span><span class="n">s</span><span class="o">&gt;</span>
<span class="o">-</span><span class="mf">0.2041200</span>	<span class="n">d</span> <span class="n">e</span> <span class="n">f</span>
<span class="o">-</span><span class="mf">0.0579919</span>	<span class="o">&lt;</span><span class="n">s</span><span class="o">&gt;</span> <span class="n">d</span> <span class="n">e</span>
<span class="o">-</span><span class="mf">0.0280287</span>	<span class="n">e</span> <span class="n">f</span> <span class="n">a</span>
<span class="o">-</span><span class="mf">0.0280287</span>	<span class="n">f</span> <span class="n">a</span> <span class="o">&lt;/</span><span class="n">s</span><span class="o">&gt;</span>

\<span class="n">end</span>\
</pre></div>
</div>
</section>
<section id="how-to-interpret-an-arpa-file">
<h2>How to interpret an arpa file<a class="headerlink" href="#how-to-interpret-an-arpa-file" title="Permalink to this headline"></a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="se">\d</span>ata<span class="se">\</span>
ngram<span class="w"> </span><span class="nv">1</span><span class="o">=</span><span class="m">8</span>
ngram<span class="w"> </span><span class="nv">2</span><span class="o">=</span><span class="m">10</span>
ngram<span class="w"> </span><span class="nv">3</span><span class="o">=</span><span class="m">9</span>
</pre></div>
</div>
<p>An arpa file begins with the literal string <code class="docutils literal notranslate"><span class="pre">\data\</span></code> in the first line.
The lines that follow it contain the number of entries for each order:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ngram</span> <span class="pre">1=8</span></code>: There are 8 entries for unigram</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ngram</span> <span class="pre">2=10</span></code>: There are 10 entries for bigram</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ngram</span> <span class="pre">3=9</span></code>: There are 9 entries for trigram. The highest order of this file
is 3.</p></li>
</ul>
</div></blockquote>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="se">\1</span>-grams:
-99.0000000<span class="w">   </span>&lt;s&gt;<span class="w">     </span>-0.8573325
-0.6989700<span class="w">    </span>a<span class="w">       </span>-0.7481880
-1.0000000<span class="w">    </span>b<span class="w">       </span>-0.8573325
-1.0000000<span class="w">    </span>c<span class="w">       </span>-0.8061800
-0.6989700<span class="w">    </span>d<span class="w">       </span>-1.1583625
-1.0000000<span class="w">    </span>e<span class="w">       </span>-0.7481880
-0.6989700<span class="w">    </span>&lt;/s&gt;
-1.0000000<span class="w">    </span>f<span class="w">       </span>-0.8061800
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">\1-grams:</span></code> means the following entries belong to unigram.
Each entry of unigram has 2 or 3 columns.</p>
<blockquote>
<div><ul class="simple">
<li><p>Column 0: probability in <span class="math notranslate nohighlight">\(\log_{10}\)</span>, i.e., <span class="math notranslate nohighlight">\(\log_{10}(p)\)</span></p></li>
<li><p>Column 1: the word</p></li>
<li><p>Column 2: back-off probability in <span class="math notranslate nohighlight">\(\log_{10}\)</span>, If this column is absent, it is
<span class="math notranslate nohighlight">\(\log_{10}(1) = 0\)</span> by default</p></li>
</ul>
</div></blockquote>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<div class="math notranslate nohighlight">
\[\log(p) = \frac{\log_{10}(p)}{\log_{10}\mathrm{e}} = \log_{10}(p) \log(10) = \log_{10}(p) \times 2.302585092994046\]</div>
<div class="math notranslate nohighlight">
\[\log_{10}(p) = \frac{\log(p)}{\log(10)} = \frac{\log(p)}{2.302585092994046} = \log(p) \times 0.4342944819032518\]</div>
</div>
</section>
<section id="how-to-use-score-a-sentence-using-arpa">
<h2>How to use score a sentence using arpa<a class="headerlink" href="#how-to-use-score-a-sentence-using-arpa" title="Permalink to this headline"></a></h2>
<section id="example-1-p-a-s">
<h3>Example 1: p(a | &lt;s&gt;)<a class="headerlink" href="#example-1-p-a-s" title="Permalink to this headline"></a></h3>
<blockquote>
<div><div class="math notranslate nohighlight">
\[\log_{10} \mathrm{p}(\mathrm{a}|\lt\!\mathrm{s}\!\gt) = -0.2041200\]</div>
</div></blockquote>
<p>We can read the value of <span class="math notranslate nohighlight">\(\log_{10} \mathrm{p}(\mathrm{a}|\lt\!\mathrm{s}\!\gt)\)</span> directly
from the arpa file.</p>
</section>
<section id="example-2-p-a-b-s">
<h3>Example 2: p(a b | &lt;s&gt;)<a class="headerlink" href="#example-2-p-a-b-s" title="Permalink to this headline"></a></h3>
<div class="math notranslate nohighlight">
\[\begin{split}\log_{10} \mathrm{p}(\mathrm{a} \mathrm{b}|\lt\!\mathrm{s}\!\gt) &amp;= \log_{10} \mathrm{p}(\mathrm{a}|\lt\!\mathrm{s}\!\gt) + \log_{10} \mathrm{p}(\mathrm{b}|\lt\!\mathrm{s}\!\gt \mathrm{a})\\
 &amp;= (-0.2041200) + (-0.0280287) \\
 &amp;= -0.23214869\end{split}\]</div>
</section>
<section id="example-3-p-a-b-s-s">
<h3>Example 3: p(a b &lt;/s&gt; | &lt;s&gt;)<a class="headerlink" href="#example-3-p-a-b-s-s" title="Permalink to this headline"></a></h3>
<div class="math notranslate nohighlight">
\[\begin{split}\log_{10} \mathrm{p}(\mathrm{a}\; \mathrm{b} \lt\!/\mathrm{s}\!\gt| \lt\!\mathrm{s}\!\gt) &amp;= \log_{10} \mathrm{p}(\mathrm{a}|\lt\!\mathrm{s}\!\gt) + \log_{10} \mathrm{p}(\mathrm{b}|\lt\!\mathrm{s}\!\gt \mathrm{a}) + \log_{10}\mathrm{p}(\lt\!/\mathrm{s}\!\gt|\mathrm{a}\;\mathrm{b})\\
 &amp;= (-0.2041200) + (-0.0280287) + \log_{10}\mathrm{p}(\lt\!/\mathrm{s}\!\gt|\mathrm{a}\;\mathrm{b})\\
 &amp;= -0.23214869 + \log_{10}\mathrm{p}(\lt\!/\mathrm{s}\!\gt|\mathrm{a}\;\mathrm{b})\\
 &amp;= -0.23214869 + \log_{10}p_{\mathrm{backoff}}(\mathrm{a}\;\mathrm{b}) + \log_{10}\mathrm{p}(\lt\!/\mathrm{s}\!\gt|\mathrm{b})\\
 &amp;= -0.23214869 + (-0.3010300) + \log_{10}\mathrm{p}(\lt\!/\mathrm{s}\!\gt|\mathrm{b})\\
 &amp;= -0.53317869 + \log_{10}p_{\mathrm{backoff}}(\mathrm{b}) + \log_{10}\mathrm{p}(\lt\!/\mathrm{s}\!\gt)\\
 &amp;= -0.53317869 + (-0.8573325) + \log_{10}\mathrm{p}(\lt\!/\mathrm{s}\!\gt)\\
 &amp;= -1.39051119 + \log_{10}\mathrm{p}(\lt\!/\mathrm{s}\!\gt)\\
 &amp;= -1.39051119 + (-0.6989700) \\
 &amp;= -2.08948119 \\\end{split}\]</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The arpa file does not contain <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">b</span> <span class="pre">&lt;/s&gt;</span></code>, so when computing
<span class="math notranslate nohighlight">\(\log_{10}\mathrm{p}(\lt\!/\mathrm{s}\!\gt|\mathrm{a}\;\mathrm{b})\)</span>, we use</p>
<div class="math notranslate nohighlight">
\[\log_{10}\mathrm{p}(\lt\!/\mathrm{s}\!\gt|\mathrm{a}\;\mathrm{b}) = \log_{10}p_{\mathrm{backoff}}(\mathrm{a}\;\mathrm{b}) + \log_{10}\mathrm{p}(\lt\!/\mathrm{s}\!\gt|\mathrm{b})\]</div>
<p>Similary, <code class="docutils literal notranslate"><span class="pre">b</span> <span class="pre">&lt;/s&gt;</span></code> also does not exist in the arpa file, we use:</p>
<div class="math notranslate nohighlight">
\[\log_{10}\mathrm{p}(\lt\!/\mathrm{s}\!\gt|\mathrm{b}) = \log_{10}p_{\mathrm{backoff}}(\mathrm{b}) + \log_{10}\mathrm{p}(\lt\!/\mathrm{s}\!\gt)\]</div>
</div>
</section>
<section id="example-4-p-b-d-s-s">
<h3>Example 4: p(b d &lt;/s&gt; | &lt;s&gt;)<a class="headerlink" href="#example-4-p-b-d-s-s" title="Permalink to this headline"></a></h3>
<div class="math notranslate nohighlight">
\[\begin{split}\log_{10} \mathrm{p}(\mathrm{b}\; \mathrm{d} \lt\!/\mathrm{s}\!\gt | \lt\!\mathrm{s}\!\gt) &amp;= \log_{10} \mathrm{p}(\mathrm{b}|\lt\!\mathrm{s}\!\gt) + \log_{10} \mathrm{p}(\mathrm{d}|\lt\!\mathrm{s}\!\gt \mathrm{b}) + \log_{10}\mathrm{p}(\lt\!/\mathrm{s}\!\gt|\mathrm{b}\;\mathrm{d})\\
&amp;= \log_{10}p_{\mathrm{backoff}}(\mathrm{\lt\!\mathrm{s}\!\gt})  +\log_{10} \mathrm{p}(\mathrm{b}) + \log_{10} \mathrm{p}(\mathrm{d}|\lt\!\mathrm{s}\!\gt \mathrm{b}) + \log_{10}\mathrm{p}(\lt\!/\mathrm{s}\!\gt|\mathrm{b}\;\mathrm{d})\\
&amp;= (-0.8573325) +  (-1.0000000) + \log_{10} \mathrm{p}(\mathrm{d}|\lt\!\mathrm{s}\!\gt \mathrm{b}) + \log_{10}\mathrm{p}(\lt\!/\mathrm{s}\!\gt|\mathrm{b}\;\mathrm{d})\\
&amp;= (-0.8573325) +  (-1.0000000) + \log_{10}p_{\mathrm{backoff}}(\mathrm{\lt\!\mathrm{s}\!\gt\mathrm{b}}) + \log_{10} \mathrm{p}(\mathrm{d}|\mathrm{b}) + \log_{10}\mathrm{p}(\lt\!/\mathrm{s}\!\gt|\mathrm{b}\;\mathrm{d})\\
&amp;= (-0.8573325) +  (-1.0000000) + 0 + \log_{10} \mathrm{p}(\mathrm{d}|\mathrm{b}) + \log_{10}\mathrm{p}(\lt\!/\mathrm{s}\!\gt|\mathrm{b}\;\mathrm{d})\\
&amp;= (-0.8573325) +  (-1.0000000) + 0 + \log_{10}p_{\mathrm{backoff}}(\mathrm{b}) + \log_{10} \mathrm{p}(\mathrm{d}) + \log_{10}\mathrm{p}(\lt\!/\mathrm{s}\!\gt|\mathrm{b}\;\mathrm{d})\\
&amp;= (-0.8573325) +  (-1.0000000) + 0 + (-0.8573325) + (-1.1583625) + \log_{10}\mathrm{p}(\lt\!/\mathrm{s}\!\gt|\mathrm{b}\;\mathrm{d})\\
&amp;= -3.8730275 + \log_{10}\mathrm{p}(\lt\!/\mathrm{s}\!\gt|\mathrm{b}\;\mathrm{d})\\
&amp;= -3.8730275 + \log_{10}p_{\mathrm{backoff}}(\mathrm{b}\;\mathrm{d}) +  \log_{10}\mathrm{p}(\lt\!/\mathrm{s}\!\gt|\mathrm{d})\\
&amp;= -3.8730275 + 0 +  \log_{10}\mathrm{p}(\lt\!/\mathrm{s}\!\gt|\mathrm{d})\\
&amp;= -3.8730275 + 0 + \log_{10}p_{\mathrm{backoff}}(\mathrm{d}) +  \log_{10}\mathrm{p}(\lt\!/\mathrm{s}\!\gt)\\
&amp;= -3.8730275 + 0 + (-1.1583625) + (-0.6989700) \\
&amp;= -5.7303600 \\\end{split}\]</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>There is no <code class="docutils literal notranslate"><span class="pre">&lt;s&gt;</span> <span class="pre">b</span></code> in the arpa file, so when computing
<span class="math notranslate nohighlight">\(\log_{10} \mathrm{p}(\mathrm{b}|\lt\!\mathrm{s}\!\gt)\)</span>, we use</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[\log_{10} \mathrm{p}(\mathrm{b}|\lt\!\mathrm{s}\!\gt) = \log_{10}p_{\mathrm{backoff}}(\mathrm{\lt\!\mathrm{s}\!\gt}) +  \log_{10} \mathrm{p}(\mathrm{b})\]</div>
</div></blockquote>
<p>There is no <code class="docutils literal notranslate"><span class="pre">&lt;s&gt;</span> <span class="pre">b</span> <span class="pre">d</span></code> in the arpa file, so when computing
<span class="math notranslate nohighlight">\(\log_{10} \mathrm{p}(\mathrm{b}|\lt\!\mathrm{s}\!\gt)\)</span>, we use</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[\begin{split}\log_{10} \mathrm{p}(\mathrm{d}|\lt\!\mathrm{s}\!\gt \mathrm{b}) &amp;= \log_{10}p_{\mathrm{backoff}}(\mathrm{\lt\!\mathrm{s}\!\gt\mathrm{b}})  + \log_{10} \mathrm{p}(\mathrm{d}|\mathrm{b})  \\
                                                                 &amp;= 0  + \log_{10} \mathrm{p}(\mathrm{d}|\mathrm{b})  \\
                                                                 &amp;= \log_{10}p_{\mathrm{backoff}}(\mathrm{b}) +\log_{10} \mathrm{p}(\mathrm{d}) \\\end{split}\]</div>
</div></blockquote>
</div>
</section>
</section>
<section id="how-to-use-kenlm-to-compute-scores">
<h2>How to use kenLM to compute scores<a class="headerlink" href="#how-to-use-kenlm-to-compute-scores" title="Permalink to this headline"></a></h2>
<p>First, let us install <code class="docutils literal notranslate"><span class="pre">kenlm</span></code> with the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>https://github.com/kpu/kenlm/archive/master.zip
</pre></div>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-number">Listing 1 </span><span class="caption-text">./code/test-kenlm.py</span><a class="headerlink" href="#id2" title="Permalink to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="ch">#!/usr/bin/env python3</span>
<span class="linenos">  2</span>
<span class="linenos">  3</span><span class="kn">import</span> <span class="nn">kenlm</span>
<span class="linenos">  4</span>
<span class="linenos">  5</span>
<span class="linenos">  6</span><span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
<span class="linenos">  7</span>    <span class="c1"># Note: When we use p(x), we are actually referring to log10(p(x))</span>
<span class="linenos">  8</span>    <span class="n">model</span> <span class="o">=</span> <span class="n">kenlm</span><span class="o">.</span><span class="n">LanguageModel</span><span class="p">(</span><span class="s2">&quot;./test.arpa&quot;</span><span class="p">)</span>
<span class="linenos">  9</span>    <span class="c1"># model.score() return probability in log10()</span>
<span class="linenos"> 10</span>
<span class="linenos"> 11</span>    <span class="c1"># p(&quot;a&quot;) in log10</span>
<span class="linenos"> 12</span>    <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">bos</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eos</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.6989700</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">1e-5</span>
<span class="linenos"> 13</span>
<span class="linenos"> 14</span>    <span class="c1"># p(a|&lt;s&gt;) in log10</span>
<span class="linenos"> 15</span>    <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">eos</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.2041200</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">1e-5</span>
<span class="linenos"> 16</span>
<span class="linenos"> 17</span>    <span class="c1"># p(a b | &lt;s&gt;)</span>
<span class="linenos"> 18</span>    <span class="c1"># = p(a | &lt;s&gt;) + p(b | &lt;s&gt; a)</span>
<span class="linenos"> 19</span>    <span class="c1"># = (-0.204120) + (-0.0280287)</span>
<span class="linenos"> 20</span>    <span class="c1"># = -0.23214869</span>
<span class="linenos"> 21</span>    <span class="c1">#  print(model.score(&quot;a b&quot;, eos=False, bos=True))</span>
<span class="linenos"> 22</span>    <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="s2">&quot;a b&quot;</span><span class="p">,</span> <span class="n">eos</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bos</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.23214869</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">1e-5</span>
<span class="linenos"> 23</span>
<span class="linenos"> 24</span>    <span class="c1"># p(a b &lt;/s&gt; | &lt;s&gt;)</span>
<span class="linenos"> 25</span>    <span class="c1"># = p(a | &lt;s&gt;) + p(b | &lt;s&gt; a) + p(&lt;/s&gt; | a b)</span>
<span class="linenos"> 26</span>    <span class="c1"># = (-0.204120) + (-0.0280287) + backoff(a b) + p(&lt;/s&gt; | b)</span>
<span class="linenos"> 27</span>    <span class="c1"># = (-0.204120) + (-0.0280287) + backoff(a b) + p(&lt;/s&gt; | b)</span>
<span class="linenos"> 28</span>    <span class="c1"># = (-0.204120) + (-0.0280287) + (-0.3010300) + backoff(b) + p(&lt;/s&gt;)</span>
<span class="linenos"> 29</span>    <span class="c1"># = (-0.204120) + (-0.0280287) + (-0.3010300) + (-0.8573325) + (-0.6989700)</span>
<span class="linenos"> 30</span>    <span class="c1"># = -2.0894812</span>
<span class="linenos"> 31</span>    <span class="c1">#  print(model.score(&quot;a b&quot;, eos=True, bos=True))</span>
<span class="linenos"> 32</span>    <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="s2">&quot;a b&quot;</span><span class="p">,</span> <span class="n">eos</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bos</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="mf">2.0894812</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">1e-5</span>
<span class="linenos"> 33</span>    <span class="c1"># Pay attention to the computation of p(&lt;/s&gt; | a b)</span>
<span class="linenos"> 34</span>    <span class="c1"># p(&lt;/s&gt; | a b)</span>
<span class="linenos"> 35</span>    <span class="c1"># = backoff (a b) + p (&lt;/s&gt; | b)</span>
<span class="linenos"> 36</span>    <span class="c1"># = backoff (a b) + backoff(b) + p(&lt;/s&gt;)</span>
<span class="linenos"> 37</span>    <span class="c1">#</span>
<span class="linenos"> 38</span>    <span class="c1"># Also note that p(&lt;/s&gt;) is 0</span>
<span class="linenos"> 39</span>
<span class="linenos"> 40</span>    <span class="c1"># p(b d &lt;/s&gt; | &lt;s&gt;)</span>
<span class="linenos"> 41</span>    <span class="c1"># = p(b | &lt;s&gt;) + p (d | &lt;s&gt; b) + p(&lt;/s&gt; | b d)</span>
<span class="linenos"> 42</span>    <span class="c1"># = backoff(&lt;s&gt;) + p(b) + p (d | &lt;s&gt; b) + p(&lt;/s&gt; | b d)</span>
<span class="linenos"> 43</span>    <span class="c1"># = backoff(&lt;s&gt;) + p(b) + backoff(&lt;s&gt; b) + p(d | b) + p(&lt;/s&gt; | b d)</span>
<span class="linenos"> 44</span>    <span class="c1"># = backoff(&lt;s&gt;) + p(b) + backoff(&lt;s&gt; b) + backoff(b) +  p(d) + p(&lt;/s&gt; | b d)</span>
<span class="linenos"> 45</span>    <span class="c1"># = backoff(&lt;s&gt;) + p(b) + backoff(&lt;s&gt; b) + backoff(b) +  p(d) + backoff(b d) + p(&lt;/s&gt; | d)</span>
<span class="linenos"> 46</span>    <span class="c1"># = backoff(&lt;s&gt;) + p(b) + backoff(&lt;s&gt; b) + backoff(b) +  p(d) + backoff(b d) + backoff(d) + p(&lt;/s&gt;)</span>
<span class="linenos"> 47</span>    <span class="c1"># = (-0.8573325) + (-1.0000000) +  0     + (-0.8573325) + (-0.6989700) + 0   + (-1.1583625) + (-0.6989700)</span>
<span class="linenos"> 48</span>    <span class="c1"># = -5.2709675</span>
<span class="linenos"> 49</span>    <span class="c1">#  print(model.score(&quot;b d&quot;, eos=True, bos=True))</span>
<span class="linenos"> 50</span>    <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="s2">&quot;b d&quot;</span><span class="p">,</span> <span class="n">eos</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bos</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="mf">5.2709675</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">1e-5</span>
<span class="linenos"> 51</span>    <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="s2">&quot;b d&quot;</span><span class="p">,</span> <span class="n">eos</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bos</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="linenos"> 52</span>    <span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">full_scores</span><span class="p">(</span><span class="s2">&quot;b d&quot;</span><span class="p">,</span> <span class="n">eos</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bos</span><span class="o">=</span><span class="kc">True</span><span class="p">)))</span>
<span class="linenos"> 53</span>    <span class="c1"># Note:</span>
<span class="linenos"> 54</span>    <span class="c1"># p(b | &lt;s&gt;) = backoff(&lt;s&gt;) + p(b)</span>
<span class="linenos"> 55</span>    <span class="c1">#</span>
<span class="linenos"> 56</span>    <span class="c1"># p(d | &lt;s&gt; b) = backoff(&lt;s&gt; b) + p (d | b)</span>
<span class="linenos"> 57</span>    <span class="c1"># since backoff (&lt;s&gt; b) does not exist, so it is 0</span>
<span class="linenos"> 58</span>    <span class="c1">#</span>
<span class="linenos"> 59</span>    <span class="c1"># p(d | b) = backoff(b) + p(d)</span>
<span class="linenos"> 60</span>    <span class="c1">#</span>
<span class="linenos"> 61</span>    <span class="c1"># p (&lt;/s&gt; | b d) = backoff(b d) + p(&lt;/s&gt; | d)</span>
<span class="linenos"> 62</span>    <span class="c1">#                = backoff(b d) + backoff(d) + p(&lt;/s&gt;)</span>
<span class="linenos"> 63</span>
<span class="linenos"> 64</span>
<span class="linenos"> 65</span><span class="k">def</span> <span class="nf">test_statefull</span><span class="p">():</span>
<span class="linenos"> 66</span>    <span class="n">model</span> <span class="o">=</span> <span class="n">kenlm</span><span class="o">.</span><span class="n">LanguageModel</span><span class="p">(</span><span class="s2">&quot;./test.arpa&quot;</span><span class="p">)</span>
<span class="linenos"> 67</span>    <span class="n">s1</span> <span class="o">=</span> <span class="n">kenlm</span><span class="o">.</span><span class="n">State</span><span class="p">()</span>
<span class="linenos"> 68</span>    <span class="n">s2</span> <span class="o">=</span> <span class="n">kenlm</span><span class="o">.</span><span class="n">State</span><span class="p">()</span>
<span class="linenos"> 69</span>    <span class="n">model</span><span class="o">.</span><span class="n">BeginSentenceWrite</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span>
<span class="linenos"> 70</span>    <span class="n">accum</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">BaseScore</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>  <span class="c1"># p(a | &lt;s&gt;)</span>
<span class="linenos"> 71</span>    <span class="c1">#  print(accum)  # -0.2041200</span>
<span class="linenos"> 72</span>    <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">accum</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">bos</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">eos</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">1e-5</span>
<span class="linenos"> 73</span>    <span class="n">accum</span> <span class="o">+=</span> <span class="n">model</span><span class="o">.</span><span class="n">BaseScore</span><span class="p">(</span><span class="n">s2</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">s1</span><span class="p">)</span>  <span class="c1"># p(a | &lt;s&gt;) +  p(b | &lt;s&gt; a)</span>
<span class="linenos"> 74</span>    <span class="c1">#  print(accum)  # -0.23214869</span>
<span class="linenos"> 75</span>    <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">accum</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="s2">&quot;a b&quot;</span><span class="p">,</span> <span class="n">bos</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">eos</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">1e-5</span>
<span class="linenos"> 76</span>
<span class="linenos"> 77</span>    <span class="c1"># reset</span>
<span class="linenos"> 78</span>    <span class="n">s1</span> <span class="o">=</span> <span class="n">kenlm</span><span class="o">.</span><span class="n">State</span><span class="p">()</span>
<span class="linenos"> 79</span>    <span class="n">s2</span> <span class="o">=</span> <span class="n">kenlm</span><span class="o">.</span><span class="n">State</span><span class="p">()</span>
<span class="linenos"> 80</span>    <span class="n">model</span><span class="o">.</span><span class="n">BeginSentenceWrite</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span>
<span class="linenos"> 81</span>    <span class="n">accum</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">BaseScore</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>  <span class="c1"># p(b | &lt;s&gt;)</span>
<span class="linenos"> 82</span>    <span class="c1">#  print(accum)  # -1.857332</span>
<span class="linenos"> 83</span>    <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">accum</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">bos</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">eos</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">1e-5</span>
<span class="linenos"> 84</span>    <span class="c1"># backoff(&lt;s&gt;) + p(b) = -0.8573325 + (-1) = -1.8573325</span>
<span class="linenos"> 85</span>    <span class="n">accum</span> <span class="o">+=</span> <span class="n">model</span><span class="o">.</span><span class="n">BaseScore</span><span class="p">(</span><span class="n">s2</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="n">s1</span><span class="p">)</span>  <span class="c1"># p(b | &lt;s&gt;) + p(c | b)</span>
<span class="linenos"> 86</span>    <span class="c1">#  print(accum)  # -1.91532436</span>
<span class="linenos"> 87</span>    <span class="c1"># p(b | &lt;s&gt;) + p(c | b) = -1.8573325 + (-0.0579919) = -1.9153244</span>
<span class="linenos"> 88</span>    <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">accum</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="s2">&quot;b c&quot;</span><span class="p">,</span> <span class="n">bos</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">eos</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">1e-5</span>
<span class="linenos"> 89</span>
<span class="linenos"> 90</span>    <span class="n">accum</span> <span class="o">+=</span> <span class="n">model</span><span class="o">.</span><span class="n">BaseScore</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>  <span class="c1"># p(b | &lt;s&gt;) + p(c | b) + p(d | b c)</span>
<span class="linenos"> 91</span>    <span class="c1">#  print(accum)</span>
<span class="linenos"> 92</span>    <span class="c1"># p(b | &lt;s&gt;) + p(c | b) + p(d | b c) = -1.9153244 + (-0.0280287) = -1.9433531</span>
<span class="linenos"> 93</span>    <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">accum</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="s2">&quot;b c d&quot;</span><span class="p">,</span> <span class="n">bos</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">eos</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">1e-5</span>
<span class="linenos"> 94</span>
<span class="linenos"> 95</span>    <span class="c1"># now for oov</span>
<span class="linenos"> 96</span>    <span class="c1"># reset</span>
<span class="linenos"> 97</span>    <span class="n">s1</span> <span class="o">=</span> <span class="n">kenlm</span><span class="o">.</span><span class="n">State</span><span class="p">()</span>
<span class="linenos"> 98</span>    <span class="n">s2</span> <span class="o">=</span> <span class="n">kenlm</span><span class="o">.</span><span class="n">State</span><span class="p">()</span>
<span class="linenos"> 99</span>    <span class="n">model</span><span class="o">.</span><span class="n">BeginSentenceWrite</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span>
<span class="linenos">100</span>    <span class="n">accum</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">BaseScore</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>  <span class="c1"># p(g | &lt;s&gt;)</span>
<span class="linenos">101</span>    <span class="c1"># p(g | &lt;s&gt;) = backoff(&lt;s&gt;) + p(&lt;unk&gt;) = -0.8573325 + (-100) = -100.8573325</span>
<span class="linenos">102</span>    <span class="nb">print</span><span class="p">(</span><span class="n">accum</span><span class="p">)</span>  <span class="c1"># -100.8573325</span>
<span class="linenos">103</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;/s&gt;&quot;</span><span class="p">]:</span>
<span class="linenos">104</span>        <span class="k">assert</span> <span class="p">(</span>
<span class="linenos">105</span>            <span class="nb">abs</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">BaseScore</span><span class="p">(</span><span class="n">s2</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">s1</span><span class="p">)</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">bos</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eos</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="linenos">106</span>            <span class="o">&lt;</span> <span class="mf">1e-5</span>
<span class="linenos">107</span>        <span class="p">)</span>
<span class="linenos">108</span>    <span class="c1">#  print(model.BaseScore(s2, &quot;kk&quot;, s1)) # -100</span>
<span class="linenos">109</span>    <span class="n">accum</span> <span class="o">+=</span> <span class="n">model</span><span class="o">.</span><span class="n">BaseScore</span><span class="p">(</span><span class="n">s2</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">s1</span><span class="p">)</span>  <span class="c1"># p(g | &lt;s&gt;) + p(a)</span>
<span class="linenos">110</span>    <span class="nb">print</span><span class="p">(</span><span class="n">accum</span><span class="p">)</span>
<span class="linenos">111</span>    <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">accum</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="s2">&quot;g a&quot;</span><span class="p">,</span> <span class="n">bos</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">eos</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">1e-5</span>
<span class="linenos">112</span>    <span class="n">accum</span> <span class="o">+=</span> <span class="n">model</span><span class="o">.</span><span class="n">BaseScore</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>  <span class="c1"># p(g | &lt;s&gt;) + p(a) + p(b|a)</span>
<span class="linenos">113</span>    <span class="nb">print</span><span class="p">(</span><span class="n">accum</span><span class="p">)</span>
<span class="linenos">114</span>
<span class="linenos">115</span>
<span class="linenos">116</span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="linenos">117</span>    <span class="n">test</span><span class="p">()</span>
<span class="linenos">118</span>    <span class="n">test_statefull</span><span class="p">()</span>
<span class="linenos">119</span>
<span class="linenos">120</span>
<span class="linenos">121</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">122</span>    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Tutorials" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2023, Fangjun Kuang.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>